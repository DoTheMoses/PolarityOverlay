<html>
  <head>
    <link id="pagestyle" rel="stylesheet" href="../programming_assets/css/2024_nounvitational.css" type="text/css" charset="utf-8">

    <script src="../programming_assets/js/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../programming_assets/js/jstween-1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../programming_assets/js/functions.js" type="text/javascript"></script>

  </head>

  <body>
    <!-- ============================================================= -->
    <!-- Scene Elements ============================================== -->
    <!-- ============================================================= -->

    <div id="scene_timer">
      <div id="timer"></div>
    </div>

    <!-- ============================================================= -->
    <!-- Main Loop =================================================== -->
    <!-- ============================================================= -->

    <script type="text/javascript">
      // data variables
      var timer_min, timer_sec;

      // backend variables
      var timestamp, timestampOld;
      var xmlDoc;
      var xhr = new XMLHttpRequest();
      var animating = false; // flag to show when animating, used as a "busy" signal
      var doUpdate = false;

      // this function inititalizes fields when the scene loads
      function init() {
        xhr.overrideMimeType('text/xml');

        var timeout = this.window.setInterval(function() {
          poll_handler();
        }, 250);

        $.play();
      }

      // this function pulls data from the stream control gui and allows us to use in our scripts here
      function load_data() {

        var stream_control_location = "../streamcontrol/streamcontrol.xml";

        xhr.open('GET', stream_control_location);
        xhr.send();

        xhr.onreadystatechange = function(){
          xmlDoc = xhr.responseXML;

          timer_min = getValueFromTag(xmlDoc, 'timer_min');
          timer_sec = getValueFromTag(xmlDoc, 'timer_sec');

          // timestamp for updating
          timestampOld = timestamp;
          timestamp = getValueFromTag(xmlDoc,'timestamp');
          }
      }

/*        // Update the count down every 1 second
        var x = setInterval(function() {

        // Get today's date and time
        var now = new Date().getTime();

        // Set the date we're counting down to
        //var countDownDate = new Date(now);
        //countDownDate.setTime(5*6000);
        //var countDownDate = new Date("Jan 1, 2100 00:"+timer_min+":"+timer_sec).getTime();
        var countDownDate = new Date(now);
        countDownDate.setTime(countDownDate.getTime() + timer_min*60000 + timer_sec*1000);

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);
        var minutes_real = 0, seconds_real = 0;

        if (seconds < 10) {
          seconds_real = "0"+seconds;
        } else {
          seconds_real = seconds;
        }

        // output the result in an element with id="demo"
        document.getElementById("timer").innerHTML = minutes + ":" + seconds_real;



        // if count down is over, write some text
        if (distance < 0) {
          clearInterval(x);
          document.getElementById("timer").innerHTML = "SOON™️";
        }

      }, 1000);*/


        var start = Date.now(),diff,minutes,seconds;
        function timer() {
        // get the number of seconds that have elapsed since 
        // startTimer() was called
        var duration = timer_min * 6 + timer_sec;
        diff = duration - (((Date.now() - start) / 1000) | 0);

        // does the same job as parseInt truncates the float
        minutes = (diff / 60) | 0;
        seconds = (diff % 60) | 0;

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        document.getElementById("timer").innerHTML = minutes + ":" + seconds;

        if (diff <= 0) {
            // add one second so that the count down starts at the full duration
            // example 05:00 not 04:59
            start = Date.now() + 1000;
        }
    };
    // we don't want to wait a full second before the timer starts
    timer();
    setInterval(timer, 1000);

      init();
    </script>
  </body>

</html>