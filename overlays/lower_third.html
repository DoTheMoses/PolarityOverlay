<html>
<head>
  <link id="pagestyle" rel="stylesheet" href="../backend/2024_nounvitational.css" type="text/css" charset="utf-8">

    <script src="../backend/js/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../backend/js/jstween-1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../backend/js/functions.js" type="text/javascript"></script>

</head>

  <body>



    <!-- ============================================================= -->
    <!-- Scene Elements ============================================== -->
    <!-- ============================================================= -->

    <div id="scene_wrapper_lower_third">

      <div id="lower_third_wrapper">

        <div id="lower_third_line_first_wrapper">
          <div id="lower_third_line_first"></div>
        </div>

        <div id="lower_third_line_second_wrapper">
          <div id="lower_third_line_second"></div>
        </div>

        <div id="left_pic_wrapper">
          <div id="left_pic"></div>
        </div>
        <div id="plate_vs_wrapper">
          <div id="plate_vs"></div>
        </div>
        <div id="right_pic_wrapper">
          <div id="right_pic"></div>
        </div>

      </div>

      <div id="local_time_text">LOCAL TIME</div>

    </div>

    <!-- ============================================================= -->
    <!-- Main Loop =================================================== -->
    <!-- ============================================================= -->

    <script type="text/javascript">
      // field variables
      var lower_third_line_first, lower_third_line_second, plate_vs;
      var l_pic, r_pic;
      var ticker_item_1, ticker_item_2, ticker_item_3, ticker_item_4, ticker_item_5;

      var timestamp_show, timestamp_show_old;
      var timestamp_hide, timestamp_hide_old;

      // backend variables
      var timestamp, timestampOld;
      var xmlDoc;    
      var xhr = new XMLHttpRequest();
      var animating = false; // flag to show when animating, used as a "busy" signal
      var doUpdate = false;

      // this function inititalizes fields when the scene loads
      function init() {

        xhr.overrideMimeType('text/xml');
            
        var timeout = this.window.setInterval(function() {
          poll_handler();
        }, 250);

        $('#lower_third_line_first').html('');
        $('#lower_third_line_first').opacity(0);
        $('#lower_third_line_second').html('');
        $('#lower_third_line_second').opacity(0);
        $('#plate_vs').html('');
        $('#plate_vs').opacity(0);
        $('#left_pic').css("background-image","none");
        $('#left_pic').opacity(0);
        $('#right_pic').css("background-image","none");
        $('#right_pic').opacity(0);

        $.play();
      }

      // this function pulls data from the stream control gui and allows us to use in our scripts here
      function load_data() {
      var stream_control_location = "../sc/streamcontrol.xml";

      xhr.open('GET', stream_control_location);
      xhr.send();
        xhr.onreadystatechange = function(){
          xmlDoc = xhr.responseXML;

          lower_third_line_first = getValueFromTag(xmlDoc,'lower_third_line_first');
          lower_third_line_second = getValueFromTag(xmlDoc,'lower_third_line_second');

          l_tag = getValueFromTag(xmlDoc, 'l_tag_current');
          r_tag = getValueFromTag(xmlDoc, 'r_tag_current');
          plate_vs = l_tag + " vs. " + r_tag;

          l_pic = "url(\"../overlays/graphics/player_photos/QUARTER_SHOTS/" + getValueFromTag(xmlDoc,'l_tag_current') + ".png\"";
          r_pic = "url(\"../overlays/graphics/player_photos/QUARTER_SHOTS/" + getValueFromTag(xmlDoc,'r_tag_current') + ".png\"";

          // timestamp for updating
          timestampOld = timestamp;
          timestamp = getValueFromTag(xmlDoc,'timestamp');
        }
      }

      // this function updates all elements in the html with new values using "tweens" to do animations
      function updateBoard() {
        if ($('#lower_third_line_first').html() != lower_third_line_first) {
          animating = true;
          $('#lower_third_line_first').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#lower_third_line_first').html(lower_third_line_first);}
          });

          $('#lower_third_line_first').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#lower_third_line_second').html() != lower_third_line_second) {
          animating = true;
          $('#lower_third_line_second').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#lower_third_line_second').html(lower_third_line_second);}
          });

          $('#lower_third_line_second').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#plate_vs').html() != plate_vs) {
          animating = true;
          $('#plate_vs').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#plate_vs').html(plate_vs);}
          });

          $('#plate_vs').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#plate_vs').html() != plate_vs) {
          animating = true;
          $('#left_pic').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#left_pic').css("background-image", l_pic);}
          });

          $('#left_pic').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#plate_vs').html() != plate_vs) {
          animating = true;
          $('#right_pic').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#right_pic').css("background-image", r_pic);}
          });

          $('#right_pic').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        $.play();
          
        doUpdate = false;
      }

    init();
    </script>

  </body>

</html>