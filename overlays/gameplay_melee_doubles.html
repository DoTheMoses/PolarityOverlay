<html>
  <head>
    <link id="pagestyle" rel="stylesheet" href="../programming_assets/css/2024_nounvitational.css" type="text/css" charset="utf-8">

    <script src="../programming_assets/js/jquery-2.0.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../programming_assets/js/jstween-1.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../programming_assets/js/functions.js" type="text/javascript"></script>

  </head>

  <body>
    <!-- ============================================================= -->
    <!-- Scene Elements ============================================== -->
    <!-- ============================================================= -->

    <div id="scene_wrapper_gameplay_melee_doubles">

      <div id="round_wrapper_doubles">
        <div id="round_doubles"></div>
      </div>

      <div id="l_tag_wrapper_doubles">
        <div id="l_tag_doubles"></div>
      </div>

      <div id="l_score_wrapper_doubles">
        <div id="l_score_doubles"></div>
      </div>

      <div id="r_tag_wrapper_doubles">
        <div id="r_tag_doubles"></div>
      </div>

      <div id="r_score_wrapper_doubles">
        <div id="r_score_doubles"></div>
      </div>

    </div>

    <!-- ============================================================= -->
    <!-- Main Loop =================================================== -->
    <!-- ============================================================= -->

    <script type="text/javascript">
      // data variables
      var round_doubles;
      var l_tag_doubles, l_score_doubles;
      var r_tag_doubles, r_score_doubles;

      // backend variables
      var timestamp, timestampOld;
      var xmlDoc;
      var xhr = new XMLHttpRequest();
      var animating = false; // flag to show when animating, used as a "busy" signal
      var doUpdate = false;

      // this function inititalizes fields when the scene loads
      function init() {

        xhr.overrideMimeType('text/xml');

        var timeout = this.window.setInterval(function() {
          poll_handler();
        }, 250);

        $('#round_doubles').html('');
        $('#round_doubles').opacity(0);

        $('#l_tag_doubles').html('');
        $('#l_tag_doubles').opacity(0);
        $('#l_score_doubles').html('');
        $('#l_score_doubles').opacity(0);

        $('#r_tag_doubles').html('');
        $('#r_tag_doubles').opacity(0);
        $('#r_score_doubles').html('');
        $('#r_score_doubles').opacity(0);

        $.play();
      }

      // this function pulls data from the stream control gui and allows us to use in our scripts here
      function load_data() {
        var stream_control_location = "../streamcontrol/streamcontrol.xml";

        xhr.open('GET', stream_control_location);
        xhr.send();

        xhr.onreadystatechange = function(){
          xmlDoc = xhr.responseXML;

          round_doubles = getValueFromTag(xmlDoc,'round_current');

          l_tag_doubles       = getValueFromTag(xmlDoc, 'l_tag_current');
          l_score_doubles     = getValueFromTag(xmlDoc, 'l_score');

          r_tag_doubles     = getValueFromTag(xmlDoc, 'r_tag_current');
          r_score_doubles   = getValueFromTag(xmlDoc, 'r_score');

          // timestamp for updating
          timestampOld = timestamp;
          timestamp = getValueFromTag(xmlDoc,'timestamp');

        }
      }

      // this function updates all elements in the html with new values using "tweens" to do animations
      function updateBoard() {

        if ($('#round_doubles').html() != round_doubles) {
          animating = true;
          $('#round_doubles').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#round_doubles').html(round_doubles);}
          });
          $('#round_doubles').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#l_tag_doubles').html() != l_tag_doubles) {
          animating = true;
          $('#l_tag_doubles').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#l_tag_doubles').html(l_tag_doubles);}
          });
          $('#l_tag_doubles').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#l_score_doubles').html() != l_score_doubles) {
          animating = true;
          $('#l_score_doubles').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#l_score_doubles').html(l_score_doubles);}
          });
          $('#l_score_doubles').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#r_tag_doubles').html() != r_tag_doubles) {
          animating = true;
          $('#r_tag_doubles').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#r_tag_doubles').html(r_tag_doubles);}
          });

          $('#r_tag_doubles').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        if ($('#r_score_doubles').html() != r_score_doubles) {
          animating = true;
          $('#r_score_doubles').tween({
            opacity: {start: 100,stop: 0,time: 0,duration: 0.5,effect: 'easeIn'},
            onStop: function(){$('#r_score_doubles').html(r_score_doubles);}
          });

          $('#r_score_doubles').tween({
            opacity: {start: 0,stop: 100,time: 0.5,duration: 0.5,effect: 'easeOut'},
            onStop: function(){animating = false;}
          });
        }

        $.play();
        doUpdate = false;
      }

      init();
    </script>
  </body>

</html>